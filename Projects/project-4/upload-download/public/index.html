<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Title</title>

		<!-- Bootstrap CSS -->

		<link rel="stylesheet" href="node_modules/bootstrap/dist/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="public/styles/app.css" type="text/css"/>

		<!-- JQuery first, then Popper.js the Bootstrap JS. -->

		<script src="node_modules/jquery/dist/jquery.js"></script>
		<script src="node_modules/popper.js/dist/popper.js"></script>
		<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>

		<!-- DOCUMENTATION: https://www.dukelearntoprogram.com/course1/doc/#simpleimage		-->
		<script src="public/js/SimpleImage.js"></script>

		<script type="text/javascript">

			$(function () {

				// ==============[ CANVAS SECTION SETTINGS ]===============

				// Hide loading feature.
				$("div#main-spinner").hide();

				const CANVAS__DEFAULT_COLOR = "#e3e0e0";

				$("canvas#image-canvas").css({
					width: "100%",
					height: 300,
					backgroundColor: CANVAS__DEFAULT_COLOR,
					borderRadius: "8px"
				});

				// Remove the clear canvas button for the image.
				$("button#clear-canvas-btn").hide();


				// ==============[ ADD SOME FUNCTIONALITIES TO THE APPLICATION ]=====

				// Change the canvas's 'title' to reflect new file
				// when a new file has been selected.

				$("input#selected-file").on("change", function () {

					const data = $(this).val().trim();
					const dataSeg = data.split("\\");
					const filename = dataSeg[dataSeg.length-1];
					// console.log("Selected filename:", filename, "Segments:", dataSeg);

					// Reveal the name of selected file to the user of the application

					$("div#image-title").html(`
						<div class="alert alert-info container">
							<span class="font-weight-bold">${filename}</span>
						</div>
					`);


					$("div#image-title").show();

					// Draw the image inside the Canvas
					__loadImageIntoCanvas();

					// Show button to clear canvas, so the user can remove chosen image.
					$("button#clear-canvas-btn").show();
				});


				// Button to upload image to server

				$("button#uploadBtn").on("click", function () {

					//loadCanvasWithInputFile();

				});

				// Button to clear the image in the canvas
				$("button#clear-canvas-btn").on("click", function () {
					const imageCanvas = $("canvas#image-canvas")[0];

					// Clear the image from the canvas
					__clearCanvas(imageCanvas, 0, 0, imageCanvas.width, imageCanvas.height);

					// Reset the selected file from input field
					$("input#selected-file").val("");

					// Hide the 'clear' button since there is no longer an image in canvas.
					$(this).hide();

					// Reset the name of file chosen above the canvas
					$("div#image-title").html(`
						<div class="alert alert-warning container">
							<span class="font-weight-bold">
								No image selected.
							</span>
						</div>
					`);

				});

				// LOAD IMAGE INTO CANVAS

				const __loadImageIntoCanvas = () => {

					// use JQuery to get it fast and use '[0]' to get DOM version1
					const selectedImg = $("input#selected-file")[0];

					const userSimpleImg = new SimpleImage(selectedImg);

					const canvas = $("canvas#image-canvas")[0];
					userSimpleImg.drawTo(canvas);
				};

				const __clearCanvas = (targetCanvas, startX, startY, widthLen, heightLen)  => {
					let mainCtx = targetCanvas.getContext("2d");
					mainCtx.fillStyle = CANVAS__DEFAULT_COLOR;
					mainCtx.clearRect(startX, startY, widthLen, heightLen);
				};



			});

		</script>

	</head>
	<body>
		<header>
			<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top mb-2 navbar-shadow">
				<div class="container">
					<a class="navbar-brand" href="#">
						File Upload App
					</a>
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarNavDropdown">
						<ul class="navbar-nav">
							<li class="nav-item active">
								<a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">Features</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" href="#">Pricing</a>
							</li>
							<li class="nav-item dropdown">
								<a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
									Dropdown link
								</a>
								<div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
									<a class="dropdown-item" href="#">Action</a>
									<a class="dropdown-item" href="#">Another action</a>
									<a class="dropdown-item" href="#">Something else here</a>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>

		<main>
			<section id="content">
				<div class="container container-lg">
					<div class="row">
						<div class="col-12 col-sm-5">
							<div class="navbar-shadow">

								<div id="main-spinner">
									<div class="spinner">
										<div class="bounce1"></div>
										<div class="bounce2"></div>
										<div class="bounce3"></div>
									</div>
								</div>

								<div id="image-title" class="text-center">
									<div class="alert alert-warning border-warning">
										No image selected
									</div>
								</div>
								<canvas class="mb-2 shadow-elem" id="image-canvas"></canvas>

								<input id="selected-file" type="file" class="btn btn-dark btn-block shadow-elem" accept="image/*">

								<div class="mt-2">
									<button id="clear-canvas-btn" class="btn btn-danger btn-block shadow-elem">
										Remove selected image
									</button>
									<button id="uploadBtn" type="button" class="btn btn-primary btn-block shadow-elem">
										Upload selected document.
									</button>
								</div>
							</div>
						</div>
						<div class="col-sm-7">
							<div class="alert alert-secondary">
								<div class="text-center">
									No documents uploaded
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>
		</main>

	</body>
</html>